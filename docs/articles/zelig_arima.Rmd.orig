---
title: "ARIMA"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{zelig-arima}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

*Built using Zelig version `r packageVersion("Zelig")`*

```{r setup, include=FALSE}
knitr::opts_knit$set(
    stop_on_error = 2L
)
knitr::opts_chunk$set(
    fig.height = 11,
    fig.width = 7
)

options(cite = FALSE)
```
---

> ++++ All Zelig time series models will be deprecated on 1 February 2018 ++++

Autoregressive and Moving-Average Models with Integration for Time-Series Data

<<<<<<< HEAD
Syntax
------

```{r, eval = FALSE}
z.out <- zarima$new()
z.out$zelig(Y ~ X1 + X2, order = c(1, 0, 0), data = mydata)
x.out$setx(z.out)
s.out$sim(z.out)
```

### Additional Inputs

Zelig accepts the following additional inputs for `arima` to specify variables that provide the time index and any cross-sectional element if there are multiple time-series in the same dataset:

-   `ts`: Name of a variable that denotes the time element of the data.  As a variable name, this should be in quotes.  If this is not provided, Zelig will assume that the data is already ordered by time, but if provided, the dataset will be sorted by this variable before estimation.

-   `cs`: Name of a variable that denotes the cross-sectional element of the data, for example, country name in a dataset with time-series across different countries.  As a variable name, this should be in quotes.  If this is not provided, Zelig will assume that all observations come from the same unit over time, and should be pooled, but if provided, individual models will be run in each cross-section.  If `cs` is given as an argument, `ts` must also be provided.
=======
>>>>>>> begin nozelig comparisons

Examples
------

### Single Series

```{r, eval = TRUE, echo = FALSE}
rm(list=ls(pattern="\\.out"))
suppressWarnings(suppressMessages(library(Zelig)))
set.seed(1234)
```

Attach sample data, which has left party seat share and unemployment across time in several countries.  We will subset to just those observations from the United Kingdom:

```{r, eval = TRUE}
library(forecast)
data(seatshare)
subset <- seatshare[seatshare$country == "UNITED KINGDOM",]
```

Estimate model:

```{r, eval = TRUE}
<<<<<<< HEAD
ts.out <- zelig(unemp ~ leftseat, model = 'arima', order = c(1, 0, 1), data = subset)
=======
ts.out <- zarima$new()
ts.out$zelig(unemp ~ leftseat, order = c(1, 0, 1), data = subset)

subset$unemp <- with(subset, ts(unemp, start = min(year), end = max(year)))
tsm <- with(subset, Arima(unemp, xreg = leftseat, order = c(1, 0, 1)))
>>>>>>> begin nozelig comparisons
```

Summarize estimated model parameters:

```{r, eval = TRUE}
summary(tsm)
```

Next we simulate what happens when leftseat share drops from a moderately high level of 75 percent, to a rather low level of 25 percent:

<<<<<<< HEAD
```{r, eval = TRUE, echo=FALSE}
ts.out <- setx(ts.out, leftseat = 0.75)
ts.out <- setx1(ts.out, leftseat = 0.25)
ts.out <- sim(ts.out)
=======
```{r, eval = TRUE}
tsm.ls75 <- forecast(tsm, xreg = rep(0.75, 10))
tsm.ls25 <- forecast(tsm, xreg = rep(0.25, 10))

plot(tsm.ls75, main = "leftseat = 0.75")
plot(tsm.ls25, main = "leftseat = 0.25")
>>>>>>> begin nozelig comparisons
```

```{r Zelig-arima, dev=c("png", "pdf"), eval = TRUE, fig.cap = "Graphs of Quantities of Interest for ARIMA models"}
plot(ts.out)
```

### AR and MA Models

AR (Autoregressive) and MA (Moving Average) models are commonly used in time series analysis. As both AR and MA models are special cases of ARIMA models they are not implemented as separate models within Zelig. Specification of AR and MA models can be accomplished by changing the value of the `order` parameter within the ARIMA model.

#### AR
```{r, eval=FALSE}
tsm2 <- with(subset, Arima(unemp, xreg = leftseat, order = c(1, 0, 0)))
summary(tsm2)
```

#### MA
```{r, eval=FALSE}
tsm3 <- with(subset, Arima(unemp, xreg = leftseat, order = c(0, 0, 1)))
```

### ARIMA
The forecast package can help you choose an auto-regressive structure.

```{r}
tsm4 <- with(subset, auto.arima(unemp, xreg = leftseat))

tsm4.ls75 <- forecast(tsm4, xreg = rep(0.75, 10))
tsm4.ls25 <- forecast(tsm4, xreg = rep(0.25, 10))

plot(tsm4.ls75, main = "leftseat = 0.75")
plot(tsm4.ls25, main = "leftseat = 0.25")
```

### Multiple Series

The dataset contains similar series for 11 different OECD countries, and we could run the same model on each country's data.  Here we need to specify the `ts` and `cs` arguments to identify the names of variables that give the time and cross-section of each observation in the dataset

```{r, eval = TRUE}
library(purrr)

seatshare <- split(seatshare, seatshare$country)
seatshare <- map(seatshare, ~ transform(., unemp = ts(unemp, start = min(year), end = max(year))))

tsm.all <- map(seatshare, ~ with(., Arima(unemp, xreg = leftseat, order = c(0, 0, 1))))

map(tsm.all, summary)
```
