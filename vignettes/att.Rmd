---
title: "Average Treatment Effects on the Treated (ATT)"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{att}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

*Built using Zelig version `r packageVersion("Zelig")`*

```{r setup, include=FALSE}
knitr::opts_knit$set(
    stop_on_error = 2L
)
knitr::opts_chunk$set(
    fig.height = 7,
    fig.width = 7
)

```
---


Average Treatment Effects on the Treated
----------------------------------------

Sometimes the quantity of interest you are interested in is the average effect of some treatment on the group of individuals that received treatment (as opposed to, for example, the effect of the treatment averaged across all individuals in a study regardless of whether or not they received the treatment). 

The tools available in R for calculating treatment effects leave a lot to be desired. For example: 

```{r message=FALSE}
library(dplyr)

# load data and estimate model
data(sanction, package = "Zelig")

m <- glm(num ~ target + coop + mil, family = "poisson", data = sanction)

actual <- predict(m,
                  newdata = filter(sanction, mil == 1),
                  type = "response")
cfact <- predict(m,
                 newdata = mutate(filter(sanction, mil == 1), mil = 0),
                 type = "response")
mean(actual - cfact)

```

In this example the treatment variable was `mil`. Units were denoted as treated when `mil = 1`. `qi = "ATT", xvalue = "TE"` specifies that we would like to extrat the ATT quantity of interest.

Note that estimating the value is not too bad, but we have no estimate of uncertainty. 

Background
==========

Assume there is a set of treatments $\mathbb{T} \in \{0,1\}$, e.g. in the example above: `mil = 0` and `mil = 1`. For each unit $i$ there are corresponding potential outcomes $Y_i(0)$ and 
$Y_i(1)$, with unit-level casual effects of the treatment typically being:  $Y_i(1) - Y_i(0)$. The unit-level causal effect is the difference between the outcome from being exposed to the treatment and not being exposed. 

We can think of the average causal effect across the entire population as:

$$
    \tau_{fs} = \frac{1}{N} \sum_{i=1}^N(Y_i(1) - Y_i(0))
$$

where $fs$ denotes a finite sample and $N$ is the number of units in the sample.

We may be particularly interested in the effect of the treatment on units that were exposed to the treatment ($i:W_i = 1$)--the ATT. The ATT is given by:

$$
    \tau_{fs,t} = \frac{1}{N_t} \sum_{i:W_i=1}^N(Y_i(1) - Y_i(0))
$$

where $N_t$ is the number of units actively exposed to the treatment.

See Also
========

Imbens, Guido W. and Donald B. Rubin. 2015. Causal inference for Statistics, 
Social and Biomedical Science. Cambridge: Cambridge University Press.
