---
title: "Zelig Quickstart Guide"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Zelig Quickstart Guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

*Built using Zelig version `r packageVersion('Zelig')`*

```{r setup, include=FALSE}
knitr::opts_knit$set(
        stop_on_error = 2L
)
```

## Workflow overview

Models in R can generally be fit using a formula interface. The fitted models
can then be explored and post-processed in various was, for example to display
an ANOVA-style table, calculate confidence intervals, or plot predictions from
the model.



# Examples

Let’s walk through an example. This example uses the swiss dataset. It contains
data on fertility and socioeconomic factors in Switzerland’s 47 French-speaking
provinces in 1888 (Mosteller and Tukey, 1977, 549-551). We will model the effect
of education on fertility, where education is measured as the percent of
draftees with education beyond primary school and fertility is measured using
the common standardized fertility measure (see Muehlenbein (2010, 80-81) for
details).

## Installing and Loading Zelig

If you haven't already done so, open your R console and install Zelig. We
recommend installing Zelig with the zeligverse package. This installs core Zelig
and ancillary packages at once.

```{r eval=FALSE}
install.packages('zeligverse')
```

Alternatively you can install the development version of Zelig with:

```{r eval=FALSE}
devtools::install_github('IQSS/Zelig')
```

Once Zelig is installed, load it:

```{r message=FALSE}
library(zeligverse)
```

## Building Models

Let’s assume we want to estimate the effect of education on fertility. Since
fertility is a continuous variable, least squares is an appropriate model
choice. To estimate our model, we call the `lm` function with two arguments:
equation and data:

```{r}
# load data
data(swiss)

# estimate ls model
z5_1 <- lm(Fertility ~ Education, data = swiss)

# model summary
summary(z5_1)
```

```{r include=FALSE}
edu_coef <- round(coef(z5_1)[[2]], digits = 2)
if (is.na(edu_coef)) stop()
```

The `r edu_coef` coefficient on education suggests a negative relationship
between the education of a province and its fertility rate. More precisely, for
every one percent increase in draftees educated beyond primary school, the
fertility rate of the province decreases `r edu_coef * -1` units. To help us
better interpret this finding, we may want other quantities of interest, such as
expected values or first differences. The `margins` package makes this simple by
automating the translation of model estimates into interpretable quantities of
interest. For example, let’s say we want to examine the effect of increasing the
percent of draftees educated from 5 to 15. There are several packages we can use for this:

```{r}
# set education to 5 and 15
library(margins)
library(prediction)
library(effects)
library(lsmeans)
library(dplyr)

## effects package
ef1 <- Effect("Education", z5_1, xlevels = list(Education = c(5, 15)))
as.data.frame(ef1)
plot(ef1)


## lsmeans package
(lsm1 <- lsmeans(z5_1, "Education", at = list(Education = c(5, 15))))
(lsm1d <- pairs(lsm1))
plot(lsm1)
plot(lsm1d)

## margins package (under development)
ppred1 <- prediction(z5_1, at = list(Education = c(5, 15)))
summarize(group_by(ppred1, Education), mean(fitted), mean(se.fitted))

cplot(z5_1)

mrgn1 <- margins(z5_1, variables = "Education", change = c(5, 15))
summary(mrgn1)
```


# Visualizations

Each of the post-estimation packages noted above offers some visualization
capabilities.

```{r}
# set education to 5 and 15
library(margins)
library(prediction)
library(effects)
library(lsmeans)
library(dplyr)

## effects package
plot(Effect("Education", z5_1))


## lsmeans package
plot(lsmeans(z5_1, "Education", at = list(Education = 0:60)))

## margins package (under development)
cplot(z5_1)

```

# Getting help


Within R you can access function help using the `?` function, e.g.:

```{r, eval=FALSE}
?lm
?Effect
```
